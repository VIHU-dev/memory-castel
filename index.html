<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Castelo da Mem√≥ria - Aventura</title>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }

    canvas {
      background: #333;
      display: block;
      margin: 0 auto;
      border: 4px solid #444;
    }

    #hud {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>üè∞ Castelo da Mem√≥ria</h1>
  <canvas id="game" width="320" height="320"></canvas>
  <div id="hud">Vida: <span id="vida">3</span></div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const tile = 32;
    const linhas = 10;
    const colunas = 10;

    const mapa = [
      "##########",
      "#........#",
      "#..##....#",
      "#..#.....#",
      "#..#..#..#",
      "#.....#..#",
      "#.###....#",
      "#........#",
      "#........#",
      "##########"
    ];

    const player = {
      x: 1,
      y: 1,
      dir: "down",
      cor: "#00ffcc",
      hp: 5,
      maxHp: 5

    };

    const teclas = {};

    window.addEventListener("keydown", (e) => {
      teclas[e.key] = true;
    });

    window.addEventListener("keyup", (e) => {
      teclas[e.key] = false;
    });

    function desenharMapa() {
      for (let y = 0; y < linhas; y++) {
        for (let x = 0; x < colunas; x++) {
          const bloco = mapa[y][x];
          ctx.fillStyle = bloco === "#" ? "#666" : "#222";
          ctx.fillRect(x * tile, y * tile, tile, tile);
        }
      }
    }

    function desenharPlayer() {
      ctx.fillStyle = player.cor;
      ctx.beginPath();
      ctx.arc(player.x * tile + tile / 2, player.y * tile + tile / 2, tile / 2.5, 0, Math.PI * 2);
      ctx.fill();

      // Olhos simples para dire√ß√£o
      ctx.fillStyle = "#000";
      if (player.dir === "up") {
        ctx.fillRect(player.x * tile + 10, player.y * tile + 8, 4, 4);
        ctx.fillRect(player.x * tile + 18, player.y * tile + 8, 4, 4);
      } else if (player.dir === "down") {
        ctx.fillRect(player.x * tile + 10, player.y * tile + 18, 4, 4);
        ctx.fillRect(player.x * tile + 18, player.y * tile + 18, 4, 4);
      } else if (player.dir === "left") {
        ctx.fillRect(player.x * tile + 6, player.y * tile + 14, 4, 4);
      } else if (player.dir === "right") {
        ctx.fillRect(player.x * tile + 22, player.y * tile + 14, 4, 4);
      }
    }

    function podeMover(x, y) {
      return mapa[y][x] !== "#";
    }

    function atualizar() {
      if (teclas["ArrowUp"]) {
        player.dir = "up";
        if (podeMover(player.x, player.y - 1)) player.y--;
      } else if (teclas["ArrowDown"]) {
        player.dir = "down";
        if (podeMover(player.x, player.y + 1)) player.y++;
      } else if (teclas["ArrowLeft"]) {
        player.dir = "left";
        if (podeMover(player.x - 1, player.y)) player.x--;
      } else if (teclas["ArrowRight"]) {
        player.dir = "right";
        if (podeMover(player.x + 1, player.y)) player.x++;
      }
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      atualizar();
      desenharMapa();
      desenharPlayer();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
    let inimigos = [
      { x: 6, y: 3, tipo: "slime", vida: 1 },
      { x: 3, y: 6, tipo: "slime", vida: 1 }
    ];

    let vida = 3;
    let atacando = false;
    let cooldown = 0;

    function desenharInimigos() {
      inimigos.forEach(inimigo => {
        if (inimigo.vida > 0) {
          ctx.fillStyle = "limegreen";
          ctx.beginPath();
          ctx.arc(inimigo.x * tile + tile/2, inimigo.y * tile + tile/2, tile/2.6, 0, Math.PI * 2);
          ctx.fill();
        }
      });
    }

    function atacar() {
      if (cooldown > 0 || atacando) return;
      atacando = true;
      cooldown = 20;

      const dx = { up: 0, down: 0, left: -1, right: 1 }[player.dir] || 0;
      const dy = { up: -1, down: 1, left: 0, right: 0 }[player.dir] || 0;

      const tx = player.x + dx;
      const ty = player.y + dy;

      inimigos.forEach(inimigo => {
        if (inimigo.x === tx && inimigo.y === ty && inimigo.vida > 0) {
          inimigo.vida = 0;
        }
      });

      setTimeout(() => atacando = false, 100);
    }

    window.addEventListener("keydown", (e) => {
      if (e.key === " ") atacar();
    });

    function verificarColisao() {
      inimigos.forEach(inimigo => {
        if (inimigo.vida > 0 && inimigo.x === player.x && inimigo.y === player.y) {
          vida--;
          document.getElementById("vida").textContent = player.hp;
          inimigo.vida = 0;
        }
      });

      if (vida <= 0) {
        alert("Voc√™ morreu! Reiniciando...");
        location.reload();
      }
    }

    // Substituir fun√ß√£o atualizar() anterior:
    function atualizar() {
      if (cooldown > 0) cooldown--;

      if (teclas["ArrowUp"]) {
        player.dir = "up";
        if (podeMover(player.x, player.y - 1)) player.y--;
      } else if (teclas["ArrowDown"]) {
        player.dir = "down";
        if (podeMover(player.x, player.y + 1)) player.y++;
      } else if (teclas["ArrowLeft"]) {
        player.dir = "left";
        if (podeMover(player.x - 1, player.y)) player.x--;
      } else if (teclas["ArrowRight"]) {
        player.dir = "right";
        if (podeMover(player.x + 1, player.y)) player.x++;
      }

      verificarColisao();
      verificarEventos();
    }

    // Substituir fun√ß√£o gameLoop() anterior:
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      atualizar();
      desenharMapa();
      drawItems(ctx);         // Desenha os itens no mapa
      checkItemPickup();      // Verifica se o jogador pegou um item
      renderHUDExtras(ctx);   // Mostra o invent√°rio na tela
      desenharInimigos();
      desenharPlayer();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
      let salas = {
      "inicio": {
        mapa: [
          [1,1,1,1,1,1,1,1,1,1],
          [1,0,0,0,0,0,0,0,0,1],
          [1,0,1,1,0,1,1,0,0,1],
          [1,0,1,0,0,0,1,0,0,1],
          [1,0,0,0,0,0,1,0,0,1],
          [1,0,1,1,1,0,1,0,0,1],
          [1,0,0,0,1,0,0,0,0,1],
          [1,1,1,0,1,1,1,1,0,1],
          [1,0,0,0,0,0,0,0,0,1],
          [1,1,1,1,1,1,1,1,1,1]
        ],
        inimigos: [
          { x: 6, y: 3, tipo: "slime", vida: 1 }
        ],
        chave: { x: 2, y: 8 }
      },
      "sala_boss": {
        mapa: [
          [1,1,1,1,1,1,1,1,1,1],
          [1,0,0,0,0,0,0,0,0,1],
          [1,0,1,1,1,1,1,1,0,1],
          [1,0,1,0,0,0,0,1,0,1],
          [1,0,1,0,1,1,0,1,0,1],
          [1,0,1,0,0,0,0,1,0,1],
          [1,0,1,1,1,1,1,1,0,1],
          [1,0,0,0,0,0,0,0,0,1],
          [1,0,0,0,0,0,0,0,0,1],
          [1,1,1,1,1,1,1,1,1,1]
        ],
        inimigos: [
          { x: 5, y: 4, tipo: "boss", vida: 3 }
        ],
        princesa: { x: 8, y: 7 }
      }
    };

    let salaAtual = "inicio";
    let chaveColetada = false;
    let venceu = false;

    function trocarSala(novaSala) {
      salaAtual = novaSala;
      player.x = 1;
      player.y = 1;
      inimigos = salas[salaAtual].inimigos.map(i => ({ ...i }));
    }

    function desenharChave() {
      const chave = salas[salaAtual].chave;
      if (chave && !chaveColetada) {
        ctx.fillStyle = "gold";
        ctx.fillRect(chave.x * tile + tile/3, chave.y * tile + tile/3, tile/3, tile/3);
      }
    }

    function desenharPrincesa() {
      const sala = salas[salaAtual];
      if (sala.princesa && !venceu) {
        const p = sala.princesa;
        ctx.fillStyle = "pink";
        ctx.beginPath();
        ctx.arc(p.x * tile + tile/2, p.y * tile + tile/2, tile/3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function verificarEventos() {
      const s = salas[salaAtual];

      // coletar chave
      if (s.chave && !chaveColetada && player.x === s.chave.x && player.y === s.chave.y) {
        chaveColetada = true;
        alert("Voc√™ encontrou a chave!");
      }

      // entrar na sala do boss
      if (salaAtual === "inicio" && player.x === 9 && player.y === 8 && chaveColetada) {
        trocarSala("sala_boss");
      }

      // vit√≥ria
      if (s.princesa && player.x === s.princesa.x && player.y === s.princesa.y) {
        venceu = true;
        alert("Voc√™ salvou a princesa! Prepare-se para o New Game+!");
        reiniciarJogo(true);
      }
    }

    function reiniciarJogo(hardmode = false) {
      player.x = 2;
      player.y = 2;
      vida = 3;
      chaveColetada = false;
      venceu = false;
      salaAtual = "inicio";
      inimigos = salas[salaAtual].inimigos.map(i => ({
        ...i,
        vida: hardmode ? 2 : i.vida
      }));
    }

    // Alterar desenho do mapa e inimigos para usar a sala atual:
    function desenharMapa() {
      const mapa = salas[salaAtual].mapa;
      for (let y = 0; y < mapa.length; y++) {
        for (let x = 0; x < mapa[y].length; x++) {
          if (mapa[y][x] === 1) {
            ctx.fillStyle = "#666";
            ctx.fillRect(x * tile, y * tile, tile, tile);
          } else {
            ctx.fillStyle = "#dcdcdc";
            ctx.fillRect(x * tile, y * tile, tile, tile);
          }
        }
      }
      desenharChave();
      desenharPrincesa();
    }
    // üéµ M√∫sica e efeitos
    let audioTema = new Audio();
    audioTema.src = "https://cdn.pixabay.com/audio/2022/03/02/audio_96c8d19e88.mp3";
    audioTema.loop = true;
    audioTema.volume = 0.3;

    let audioHit = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4da1044a3f.mp3?filename=sword-hit-7165.mp3");
    let audioWin = new Audio("https://cdn.pixabay.com/download/audio/2021/09/06/audio_685f8a1c30.mp3?filename=win-1-6416.mp3");

    document.addEventListener("keydown", () => {
      if (audioTema.paused) {
        audioTema.play().catch(() => {});
      }
    }, { once: true });

    function dialogoPrincesa() {
      setTimeout(() => {
        alert("Princesa: Obrigada por me salvar, her√≥i! Mas o mal retorna mais forte a cada ciclo...");
      }, 100);
    }

    function reiniciarJogo(hardmode = false) {
      player.x = 2;
      player.y = 2;
      vida = 3;
      chaveColetada = false;
      venceu = false;
      salaAtual = "inicio";
      inimigos = salas[salaAtual].inimigos.map(i => ({
        ...i,
        vida: hardmode ? i.vida + 1 : i.vida
      }));

      if (hardmode) {
        alert("Modo New Game+ ativado! Prepare-se!");
      }
    }

    function verificarEventos() {
      const s = salas[salaAtual];

      if (s.chave && !chaveColetada && player.x === s.chave.x && player.y === s.chave.y) {
        chaveColetada = true;
        alert("Voc√™ encontrou a chave!");
      }

      if (salaAtual === "inicio" && player.x === 9 && player.y === 8 && chaveColetada) {
        trocarSala("sala_boss");
      }

      if (s.princesa && player.x === s.princesa.x && player.y === s.princesa.y && !venceu) {
        venceu = true;
        audioWin.play();
        dialogoPrincesa();
        setTimeout(() => {
          mostrarCreditos();
        }, 1500);
      }
    }

    function mostrarCreditos() {
      let msg = "üè∞ CASTELO DAS MEM√ìRIAS\n\n";
      msg += "Criado com HTML5 + JS puro\n";
      msg += "Gr√°ficos e l√≥gica gerados por c√≥digo\n";
      msg += "\nüéÆ Obrigado por jogar!";
      alert(msg);
      reiniciarJogo(true);
    }

    // Opcional: anima√ß√£o na vit√≥ria
    function animarVitoria() {
      ctx.fillStyle = "#000000aa";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "white";
      ctx.font = "32px Arial";
      ctx.fillText("Voc√™ salvou a princesa!", 80, canvas.height / 2);
    }
    // Inicia o jogo
    gameLoop();
  </script>
</body>
</html>
<script>
// INVENT√ÅRIO
const inventory = {
  sword: false,
  potion: 0,
  key: false
};

// Exibir HUD do invent√°rio
function drawInventory(ctx) {
  ctx.fillStyle = "#222";
  ctx.fillRect(10, 10, 150, 70);
  ctx.fillStyle = "#fff";
  ctx.font = "14px Arial";
  ctx.fillText("üéí Invent√°rio", 20, 28);
  ctx.fillText(`üó°Ô∏è Espada: ${inventory.sword ? "Sim" : "N√£o"}`, 20, 44);
  ctx.fillText(`üß™ Po√ß√µes: ${inventory.potion}`, 20, 60);
  ctx.fillText(`üóùÔ∏è Chave: ${inventory.key ? "Sim" : "N√£o"}`, 20, 76);
}

// Atualize seu loop de desenho (dentro de gameLoop por ex.)
function renderHUDExtras(ctx) {
  drawInventory(ctx);
}

// Para usar po√ß√£o: tecla 'H' (cura 3 de vida)
document.addEventListener("keydown", (e) => {
  if (e.key.toLowerCase() === "h") {
    if (inventory.potion > 0 && player.hp < player.maxHp) {
      inventory.potion--;
      player.hp = Math.min(player.hp + 3, player.maxHp);
      // Efeito sonoro ou mensagem
      console.log("Voc√™ usou uma po√ß√£o!");
    }
  }
});
// Lista de itens no mundo
const worldItems = [
  { x: 3, y: 2, type: "sword", collected: false },
  { x: 5, y: 4, type: "potion", collected: false },
  { x: 6, y: 1, type: "potion", collected: false },
  { x: 2, y: 5, type: "key", collected: false }
];

// Desenhar itens no mapa
function drawItems(ctx) {
  for (const item of worldItems) {
    if (item.collected) continue;
  const screenX = item.x * tile;
  const screenY = item.y * tile;

    ctx.fillStyle = {
      sword: "#cfc",
      potion: "#f88",
      key: "#ff0"
    }[item.type] || "#ccc";

    ctx.beginPath();
    if (item.type === "sword") {
      ctx.fillRect(screenX + 8, screenY + 16, 8, 16);
      ctx.fillRect(screenX + 12, screenY + 8, 2, 8);
    } else if (item.type === "potion") {
      ctx.arc(screenX + 16, screenY + 16, 6, 0, Math.PI * 2);
    } else if (item.type === "key") {
      ctx.arc(screenX + 16, screenY + 16, 5, 0, Math.PI * 2);
      ctx.fillRect(screenX + 15, screenY + 10, 2, 10);
    }
    ctx.fill();
  }
}

// Verificar se jogador pegou um item
function checkItemPickup() {
  for (const item of worldItems) {
    if (!item.collected && player.x === item.x && player.y === item.y) {
      item.collected = true;
      if (item.type === "sword") inventory.sword = true;
      if (item.type === "potion") inventory.potion++;
      if (item.type === "key") inventory.key = true;
      console.log(`Voc√™ pegou um(a) ${item.type}!`);
    }
  }
}

</script>
